{% block content %}


<div class="row">
	{% if innslag.avmeldbar == false %}
		<div class="col-xs-12">
			<div class="alert alert-info">
				<b>OBS:</b>
				<p>
					Innslaget startet påmeldingen for kort tid siden ({{ innslag.subscription.date|dato('d.M H:i') }}), 
                    og det er derfor mulig at de fortsatt jobber med påmeldingen sin. 
					Vi anbefaler at du venter til {{ innslag.avmeldlas|dato('d.M H:i') }}
					før du gjør endringer eller melder av innslaget!
				</p>
			</div>
		</div>
	{% endif %}
	{% if innslag.advarsler|length > 0 %}
		<div class="col-xs-12">
			<div class="alert alert-warning">
				<p>
					<b>Innslaget har blitt flagget for følgende advarsler:</b>
				</p>
				<ul class="list-group list-group-compact">
					{% for advarsel in innslag.advarsler %}
						<li class="list-group-item">{{ advarsel.melding }}</li>
					{% endfor %}
				</ul>
				<p>Du trenger ikke å gjøre noe med dette, da dette bare er et hint fra systemet om at innslaget kan by på en overraskelse i gjennomføringen</p>
			</div>
		</div>
	{% endif %}
    {% if innslag.mangler|length > 0 %}
        <div class="col-xs-12">
			<div class="alert alert-warning">
				<p>
					<b>Innslaget mangler følgende for å være en fullstendig påmelding:</b>
				    <br />
                    Du trenger ikke å utbedre alle disse, 
                    da det er opp til deg hvor mye info du trenger til din gjennomføring.
				</p>
				<ul class="list-group list-group-compact">
					{% for mangel in innslag.mangler %}
						<li class="list-group-item">
                            {#<b>{{ mangel.navn }}:</b>#}
                            {{mangel.beskrivelse}}
                            </li>
					{% endfor %}
				</ul>
			</div>
		</div>
    {% endif %}
	<fieldset class="col-xs-12 col-sm-6 col-lg-3">
		<legend class="hidden-xs">Informasjon</legend>
		<p>
			<label>Kontaktperson:
			</label>
			{{ innslag.kontaktperson.fornavn }}
			{{ innslag.kontaktperson.etternavn }}
			<br/>
			<label>Mobil:
			</label>
			<a href="#innslag_{{ innslag_id }}" class="UKMSMS" data-to="{{innslag.kontaktperson.mobil}}" data-navn="{{innslag.kontaktperson.navn}}">{{ innslag.kontaktperson.mobil }}</a>
			<br/>
			<label>E-post:
			</label>
			<a href="mailto:{{ innslag.kontaktperson.epost }}">{{ innslag.kontaktperson.epost }}</a>
			<br/>
			{# Bruker samme sjekk som i edit #}
			{% if 1 == innslag.type.id %}
				<label>Sjanger:
				</label>
				{{ innslag.sjanger }}
				<br/>
			{% endif %}
			<label>Beskrivelse:
			</label>
			{{ innslag.beskrivelse }}
			{% if innslag.type.harTekniskeBehov %}
				<br/>
				<label>Tekniske behov:
				</label>
				{{ innslag.tekniske_behov }}
			{% endif %}
		</p>
		<a href="#innslag_{{ innslag_id }}" class="actionEdit btn btn-block btn-primary btn-outline">Rediger informasjon</a>

		<a href="#innslag_{{ innslag_id }}" class="action btn btn-block btn-primary btn-outline" data-action="changeContact">Bytt kontaktperson</a>

	</fieldset>

	<fieldset class="col-xs-12 col-sm-6 col-lg-3">
		<legend>
			<small>Personer</small>
        </legend>
		<p class="explain">Snittalder: {{ innslag.snittalder }}år</p>
		{% set msgDelIsContact = ' er kontaktperson for '~ innslag.navn ~' og vil fortsatt stå som kontaktperson. '|escape %}
		{% set msgConfirmDelPerson = 'Er du sikker på at du vil fjerne ' %}
		{% set br = '\\r\\n\\r\\n'|escape %}

		{% if innslag.personer|length > 0 and innslag.personer_ekstra|length > 0 %}
			<label class="b uppercase small text-muted" style="font-weight: normal;margin-top: -1em;margin-bottom: -.5em;">Deltar på ditt arrangement</label>
		{% endif %}
		<ol class="list-group list-group-compact" style="margin-bottom: 2em;">
			{% for person in innslag.personer %}
				<li class="list-group-item person clickChildLink" data-person-id="{{ person.id }}">
					<div class="pull-right">
						{% if person.slettbar %}
							<a href="#innslag{{innslag_id}}" class="action btn btn-danger btn-xs" data-action="simpleSave" data-handle="deletePerson" data-object-id="{{ person.id }}" data-warning="{{ person.id == innslag.kontaktperson.id ? person.fornavn ~ msgDelIsContact ~ br : '' }}{{ msgConfirmDelPerson ~ person.fornavn ~'?' }}">Fjern</a>
						{% else %}
							<a href="#innslag{{innslag_id}}" class="action btn btn-danger btn-xs" data-action="simpleSave" data-handle="personUnforward" data-object-id="{{ person.id }}" data-warning="Vil du fjerne {{ person.fornavn }} fra innslaget på ditt arrangement? {{ person.fornavn }} vil fortsatt stå som deltaker i innslaget hos andre arrangement. {{ person.id == innslag.kontaktperson.id ? br ~ person.fornavn ~ msgDelIsContact : '' }}{{ br ~ msgDelPerson }}">Skal ikke delta</a>
						{% endif %}
					</div>
					<a href="#" data-action="editPerson" data-person-id="{{ person.id }}" class="action momClickMe">{{ person.fornavn }} {{ person.etternavn}}</a>
					<br/>
					{% if person.rolle %}
						<small>{{ person.rolle }}</small>
					{% else %}
						<div class="clearfix"></div>
					{% endif %}
				</li>
			{% endfor %}
			<li class="list-group-item">
				<a href="#innslag_{{ innslag_id }}" data-action="addPerson" class="action">+ Legg til person</a>
			</li>
		</ol>

		{% if innslag.personer_ekstra|length > 0 %}
            <label class="b uppercase small text-muted" style="font-weight: normal;margin-top: -1em;margin-bottom: -.5em;">Deltar ikke på ditt arrangement</label>
			<ol class="list-group list-group-compact" style="margin-bottom: 2em;">
				{% for person in innslag.personer_ekstra %}
					<li class="list-group-item person clickChildLink" data-person-id="{{ person.id }}">
						<div
							class="pull-right">
							<a href="#" class="action btn btn-success btn-xs" data-action="simpleSave" data-handle="personForward" data-object-id="{{ person.id }}" data-warning="{{ person.fornavn }} er en del av {{ innslag.navn }} på et annet arrangement, men er ikke påmeldt ditt. Vil du melde {{ person.fornavn }} på ditt arrangement?">Skal delta</a>

							{% if person.slettbar %}
								<a href="#innslag{{innslag_id}}" class="action btn btn-danger btn-xs" data-action="simpleSave" data-handle="deletePerson" data-object-id="{{ person.id }}" data-warning="{{ person.id == innslag.kontaktperson.id ? msgDelIsContact ~ br : '' }}{{ msgConfirmDelPerson ~ person.fornavn ~'?' }}">Fjern</a>
							{% endif %}
						</div>
						<a href="#" data-action="editPerson" data-person-id="{{ person.id }}" class="action momClickMe text-muted">{{ person.fornavn }} {{ person.etternavn}}</a>
						<br/>
						{% if person.rolle %}
							<small>{{ person.rolle }}</small>
						{% else %}
							<div class="clearfix"></div>
						{% endif %}
					</li>
				{% endfor %}
			</ol>
		{% endif %}
	</fieldset>

    <fieldset class="col-xs-12 col-sm-6 col-lg-3">
        {% if innslag.type.harTitler %}
            <legend>
                <small>{{ erKunstgalleri ? 'Kunstverk' : 'Titler' }}</small>
            </legend>
            <p class="explain">
                {% if innslag.type.harTid %}Varighet: {{ innslag.varighet_human }}{% else %}&nbsp;{% endif %}
            </p>

            {% if innslag.titler|length > 0 and innslag.titler_ekstra|length > 0 %}
                <label class="b uppercase small text-muted" style="font-weight: normal;margin-top: -1em;margin-bottom: -.5em;">Fremføres på ditt arrangement</label>
            {% endif %}
            <ol class="list-group list-group-compact" style="margin-bottom: 2em;">
                {% for tittel in innslag.titler %}
                    <li class="list-group-item person clickChildLink" data-tittel-id="{{ tittel.id }}">
                        <div class="pull-right">
                            {% if tittel.slettbar %}
                                <a href="#innslag_{{innslag_id}}" class="action btn btn-danger btn-xs" data-warning="Er du sikker på at du vil fjerne {{ tittel.tittel }} fra {{ innslag.navn }}?" data-action="simpleSave" data-handle="deleteTitle" data-object-id="{{ tittel.id }}">Fjern</a>
                            {% else %}
                                <a href="#innslag_{{innslag_id}}" class="action btn btn-danger btn-xs" data-warning="Vil du fjerne {{ tittel.tittel }} fra innslaget på ditt arrangement? {{ tittel.tittel }} vil fortsatt stå som 'skal fremføres' på andre arrangement." data-action="simpleSave" data-handle="tittelUnforward" data-object-id="{{ tittel.id }}">Skal ikke fremføres</a>
                            {% endif %}
                        </div>

                        <a href="#" class="action momClickMe" data-action="editTitle" data-title-id="{{ tittel.id }}">{{ tittel.tittel }}</a>
                        <br/>
                        <small>{{ innslag.type.harTid ? 'Varighet: '~ tittel.varighet_human : '&nbsp;' }}</small>
                    </li>
                {% endfor %}
                <li class="list-group-item">
                    <a href="#innslag_{{ innslag_id }}" class="action" data-action="addTitle">+ Legg til {{ erKunstgalleri ? 'kunstverk' : 'tittel' }}</a>
                </li>
            </ol>
            {% if innslag.titler_ekstra|length > 0 %}
                <label class="b uppercase small text-muted" style="font-weight: normal;margin-top: -1em;margin-bottom: -.5em;">Fremføres ikke på ditt arrangement</label>
                <ol class="list-group list-group-compact" style="margin-bottom: 2em;">
                    {% for tittel in innslag.titler_ekstra %}
                        <li class="list-group-item person clickChildLink" data-tittel-id="{{ tittel.id }}">
                        <div class="pull-right">
                            <a href="#innslag_{{innslag_id}}" class="action btn btn-success btn-xs" data-warning="{{ tittel.tittel }} ble fremført på lokalmønstringen. Vil du at denne også skal fremføres på din festival?" data-action="simpleSave" data-handle="tittelForward" data-object-id="{{ tittel.id }}">Skal fremføres</a>
                        </div>
                        <a href="#" class="action momClickMe" data-action="editTitle" data-title-id="{{ tittel.id }}">{{ tittel.tittel }}</a>
                        <br/>
                        <small>{% if innslag.type.harTid %}Varighet: {{ innslag.varighet_human }}{% else %}&nbsp;{% endif %}</small>
                    </li>
                    {% endfor %}
                </ol>
            {% endif %}
        {% endif %}
    </fieldset>

	{% if innslag.status == 8 %}
		<fieldset class="col-xs-12 col-sm-6 col-lg-3 pull-right">
			<legend>
				<small>Program</small>
			</legend>
			<p class="explain">
				&nbsp;
			</p>

			<ol class="list-group list-group-compact">
				{% for hendelse in innslag.hendelser %}
					<li class="list-group-item">
						Nr
						{{ hendelse.rekkefolge }}
						i
						<a href="admin.php?page=UKMprogram_admin&c_id={{ hendelse.id }}">{{ hendelse.navn }}</a>
						<a href="#innslag_{{ innslag_id }}" class="action btn btn-danger btn-xs pull-right" data-action="simpleSave" data-handle="deleteFromEvent" data-object-id="{{ hendelse.id }}" data-warning="Sikker på at du vil fjerne {{ innslag.navn }} fra {{ hendelse.navn }}?">Fjern</a>
						<div class="clearfix"></div>
					</li>
				{% else %}
					<li class="list-group-item">
						<small>Ikke lagt til i noen programhendelser</small>
					</li>
				{% endif %}
				<li class="list-group-item">
					<a href="#innslag_{{ innslag_id }}" class="actionEventAdd">+ Legg til i program</a>
				</li>
			</ol>
		</fieldset>
	{% endif %}

	{% if lignende is defined %}
		<div class="clearfix"></div>
		<fieldset class="col-xs-12">
			<legend>
				<small>Lignende innslag</small>
			</legend>
			<p class="explain">
				Ofte er ufullstendige påmeldinger et duplikat av en fullført påmelding, eller så har kontaktpersonen meldt på et annet innslag.
								Listen over lignende innslag viser deg innslag med lignende navn, eller andre innslag hvor noen av personene er med.
			</p>

			<p>
				<b>{{ alle_lignende|length }}
					innslag på din mønstring ligner på
					{{ innslag.navn }}</b>:
			</p>
			<ol class="list-group list-group-compact">
				{% for lignende in alle_lignende %}
					<li class="list-group-item">
						<div class="col-xs-12 col-sm-6">
							<i class="label label-xs label-{{ lignende.status == 8 ? 'success' : 'warning' }}">{{ lignende.status == 8 ? 'Påmeldt' : 'Ufullstendig påmelding' }}</i>
							&nbsp;
							<b>{{ lignende.navn }}</b>
                            <span class="text-muted">{{ lignende.type.navn|capitalize }}{{ lignende.type.harSjanger ? ' - ' ~lignende.sjanger : ''}}</span>
						</div>
						<div class="col-xs-12 col-sm-6 small">
							Fordi
							{{ lignende.grunnlag }}
						</div>
						<div class="clearfix"></div>
					</li>
				{% else %}
					<li class="list-group-item">Fant ingen lignende innslag</li>
				{% endif %}
			</ol>
		</fieldset>
		<div class="clearfix"></div>
	{% endif %}

	<div class="clearfix visible-lg"></div>

	<fieldset class="col-xs-12">
		<legend>
			<small>Handlinger</small>
		</legend>

		<div class="col-xs-12 row">
			<div class="col-xs-12 col-sm-6">
				<div class="row">
					<h4>Intoleranser og allergier</h3>
					<div class="list-group-item" style="display: flex;">
						<select class="intoleranse_ny-select" class="form-control">
							<option value="false" selected disabled>Velg person</option>
							{% for person in innslag.personer %}
								<option value="{{ person.id }}" {{ person.intoleranse_liste != null ? 'hidden' : '' }} data-mobil="{{person.mobil}}">{{ person.navn }}</option>
							{% endfor %}
						</select>
						<button class="btn btn-primary btn-sm" id="intoleranse_add" type="button">Legg til allergi/intoleranse</button>
					</div>
				
					<div>						
						<ul class="intoleranser-ul">
							{% for person in innslag.personer %}
								{% if person.intoleranse_liste != null %}

									{# TEMPLATE start #}

									<li class="person clickable list-group-item" id="{{ person.id }}" data-id="{{ person.id }}">
										<div class="row header-person" data-toggle="collapse" href="#personKontroll{{ innslag.id }}{{ person.id }}" role="button" aria-expanded="false" aria-controls="personKontroll{{ innslag.id }}{{ person.id }}">
											<div class="col-xs-12">
												<span class="type strong"></span>
												<span class="navn">
													{{ person.navn }}
													<small class="text-muted"><span class="dashicons dashicons-smartphone" style="font-size:1.2em;padding-top:.4em;"></span>
													<span class="UKMmobil UKMSMS" data-navn="{{person.navn}}" data-to="{{person.mobil}}">{{person.mobil}}</span>
													</small>
												</span>
												<span class="status float-right pull-right small">{{ person.intoleranse_human }}</span>
											</div>
										</div>
										<div id="personKontroll{{ innslag.id }}{{ person.id }}" class="data row collapse">
											<form class="leder_edit_form condensed">
												<div class="col-xs-4">
													<div class="form-group">
														<table class="intoleranser table-condensed table-striped" style="width:99%">
															{% for allergen in allergener_kulturelle %}
																<tr>
																	<td>
																		<label>
																			<input type="checkbox" name="allergen" value="{{ allergen.id }}" {% if allergen.id in person.intoleranse_liste %}checked{% endif %} />
																			{{ allergen.navn }}
																		</label>
																	</td>
																</tr>
															{% endfor %}
														</table>
													</div>
												</div>
												<div class="col-xs-8 col-md-4">
													<div class="form-group">
														<table class="intoleranser table-condensed table-striped" style="width:99%">
															{% for allergen in allergener_standard %}
																<tr>
																	<td>
																		<label>
																			<input type="checkbox" name="allergen" value="{{ allergen.id }}" {% if allergen.id in person.intoleranse_liste %}checked{% endif %} />
																			{{ allergen.navn }}
																		</label>
																	</td>
																</tr>
															{% endfor %}
														</table>
													</div>
												</div>
												<div class="col-xs-12">
													<label>Tilleggsinformasjon</label>
													<textarea class="form-control intoleranse_tekst" rows="3">{{ person.intoleranse.intoleranse_tekst }}</textarea>
												</div>
												<div class="col-xs-12">
													<div class="float-right pull-right">
														<button type="button" class="intoleranse_update btn btn-ukm btn-sm btn-success">Lagre</button>
													</div>
													<div class="clearfix"></div>
												</div>
											</form>
										</div>
									</li>

									{# TEMPLATE end #}
								</ul>
								{% endif %}
							{% endfor %}
					</div>
				</div>
			</div>

			<div class="col-xs-12 col-sm-6 arrangor-kommentarer">

				<h4>Arrangør-kommentarer</h4>
				<p>Kommentarer vil være tilgjengelig som eget valg når du henter ut rapporter, men publiseres ikke noe sted på ukm.no. Pass derfor på hva du noterer / hva du tar ut i rapporter.</p>
				<textarea id="arrangorKommentar" name="arrangor_kommentar" style="width: 100%; height: 100px;">{{ innslag.arrangorKommentar }}</textarea>
				<a href="#" style="float: right; margin-top: 15px;" type="button" class="action btn btn-ukm btn-sm btn-success" onclick="jQuery(event.currentTarget).attr('data-arrangor-kommentar', jQuery('#arrangorKommentar').val())" data-action="simpleSave" data-handle="arrangorKommentar" data-arrangor-kommentar="{{ innslag.arrangorKommentar }}">Lagre</a>

				
			</div>
		</div>

		<div class="col-xs-12 col-sm-12 col-md-12 col-lg-3 row" style="margin-top: 20px;">
            {% if innslag.status != 8 %}
                <a href="#innslag_{{ innslag_id }}" class="action btn btn-block btn-success col-xs-12 col-sm-4 col-lg-3" data-action="meldPa">Meld på UKM</a>
            {% endif %}

            {% if innslag.avmeldbar %}
                <a href="#innslag_{{ innslag_id }}" class="action btn btn-block btn-danger col-xs-12 col-sm-4 col-lg-3" data-action="simpleSave" data-handle="meldAvInnslag" data-object-id="{{ innslag_id }}" data-warning="Sikker på at du vil melde av {{ innslag.navn }} fra UKM?">Meld av UKM</a>
            {% else %}
                <a href="#innslag_{{ innslag_id }}" class="action btn btn-block btn-danger col-xs-12 col-sm-4 col-lg-3" data-action="simpleSave" data-handle="meldAvInnslag" data-object-id="{{ innslag_id }}" data-warning="Sikker på at du vil melde av {{ innslag.navn }} fra UKM? Selv om de startet påmeldingen sin for kort tid siden?">Meld av UKM</a>
            {% endif %}
		</div>
		<div class="clearfix"></div>
		<p>&nbsp;</p>
		<div class="clearfix"></div>
		<p style="text-align: right;">
			<a href="#innslag_{{ innslag_id }}" class="action" data-action="close">lukk</a>
		</p>
	</fieldset>
</div>


{% endblock %}
